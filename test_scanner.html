<!DOCTYPE html>
<html>
<head>
  <title>Scanner Tester</title>
  <style>
    body { font-family: Arial, sans-serif; }
    .no-print { margin-bottom: 20px; }
    @media print {
      body { margin: 0; }
      .no-print { display: none; }
      .canvas-container { display: block; width: 100%; height: 100%; }
      canvas { width: 100%; height: auto; }
    }
  </style>
</head>
<body>
  <h1 class="no-print">Scanner Tester</h1>
  <button onclick="downloadPNG()" class="no-print">Download PNG</button>
  <button onclick="printImage()" class="no-print">Print</button>
  <div class="canvas-container">
    <canvas id="matrixCanvas"></canvas>
  </div>

  <script>
    function generateMatrix() {
      const canvas = document.getElementById('matrixCanvas');
	    const paperWidthMM = 210
	    const paperHeightMM = 297
	    const marginMM = 5
	    const MMperInch = 25.4
	    const printWidthInch = (paperWidthMM-2*marginMM)/MMperInch
	    const printHeightInch = (paperHeightMM-2*marginMM)/MMperInch
	    const dpi = 1200
	    const printWidthPX = printWidthInch*dpi
	    const printHeightPX = printHeightInch*dpi
        canvas.width = printWidthPX;
        canvas.height = printHeightPX;
	      console.log(canvas.width, canvas.height)

      const ctx = canvas.getContext('2d');
      ctx.clearRect(0, 0, canvas.width, canvas.height);
	    const arr = [100, 200, 300, 310, 320, 330, 340, 350, 360, 370, 380, 390, 400, 410];
	    let y = 0;
	    for (let mult of arr) {
		    const a = Math.floor(canvas.width / mult);
		    let start = true;
		    for (let row = 0; row < 20; row++) {
			    let bit = start;
			    for (let idx = 0; idx < mult; idx++) {
				    const x = idx * a;
				    ctx.fillStyle = bit ? 'black' : 'white';
				    ctx.fillRect(x, y, a, a);
				    bit = !bit;
			    }
			    y += a;
			    start = !start;
		    }
		    y += 120;
	    }
    }
	  generateMatrix();

    function downloadPNG() {
      const canvas = document.getElementById('matrixCanvas');
      const link = document.createElement('a');
      link.download = 'encoded_image.png';
      link.href = canvas.toDataURL();
      link.click();
    }

    function printImage() {
      const canvas = document.getElementById('matrixCanvas');
      const img = new Image();
      img.src = canvas.toDataURL();

      img.onload = function() {
        const printWindow = window.open('', '', 'width=800,height=600');
        printWindow.document.write('<html><body style="text-align:center;">');
        printWindow.document.write('<img src="' + img.src + '" style="max-width:100%; height:auto;"/>');
        printWindow.document.write('</body></html>');
        printWindow.document.close();
        printWindow.print();
      };
    }
  </script>
</body>
</html>
